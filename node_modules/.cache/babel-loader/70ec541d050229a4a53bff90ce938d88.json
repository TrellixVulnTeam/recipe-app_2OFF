{"ast":null,"code":"var _jsxFileName = \"/Users/beatrizbarbosa/Projects/trybe-projects/sd-010-a-project-recipes-app/src/pages/ComidasEmProcesso.js\";\nimport React, { useEffect, useState } from 'react';\nimport { useParams, useHistory } from 'react-router-dom';\nimport copy from 'clipboard-copy';\nimport fetchAPI from '../services/index';\nimport heartWhite from \"../images/whiteHeartIcon.svg\";\nimport heartBlack from \"../images/blackHeartIcon.svg\";\nimport shareimg from \"../images/shareIcon.svg\";\nimport { createIngredientsList } from '../utils';\nimport { MEALS_BY_ID_ENDPOINT } from '../services/meals';\nimport '../css/ComidasEmProcessoCSS.css';\n\nfunction ComidasEmProcesso() {\n  const {\n    id\n  } = useParams();\n  const history = useHistory();\n  const [meal, setMeal] = useState({});\n  const [loading, setLoading] = useState(false);\n  const [finished, setFinished] = useState(true);\n  const [share, setShare] = useState(false);\n  const [listIngredients, setListIngredients] = useState([]);\n  const storage = JSON.parse(localStorage.getItem('inProgressRecipes'));\n  const [indexChecked, setIndexChecked] = useState(storage.meals[id] || []);\n  const storageFavorite = JSON.parse(localStorage.getItem('favoriteRecipes')) || [];\n  const [favorite, setFavorite] = useState(storageFavorite.some(item => item.id === id)); // se retorna true está favoritado, se falso nao estava favoritado\n\n  useEffect(() => {\n    setLoading(true);\n\n    const fetchMeal = async () => {\n      const data = await fetchAPI(MEALS_BY_ID_ENDPOINT(id));\n      setMeal(data.meals[0]);\n      const ingredientes = createIngredientsList(data.meals[0]);\n      const filter = ingredientes.filter(item => item[0] !== undefined);\n      setListIngredients(filter);\n      setLoading(false);\n    };\n\n    fetchMeal();\n  }, [id]);\n  useEffect(() => {\n    const previousIngredientes = JSON.parse(localStorage.getItem('inProgressRecipes'));\n    const newIngredientes = { ...previousIngredientes,\n      meals: { ...previousIngredientes.meals,\n        [id]: indexChecked\n      }\n    };\n    localStorage.setItem('inProgressRecipes', JSON.stringify(newIngredientes));\n    setFinished(listIngredients.length !== indexChecked.length);\n  }, [indexChecked, listIngredients, id]);\n\n  function handleClick() {\n    // se retorna true está favoritado, se falso nao estava favoritado\n    setFavorite(!favorite);\n    const newFavorite = [...storageFavorite, {\n      id,\n      type: 'comida',\n      area: meal.strArea,\n      category: meal.strCategory,\n      alcoholicOrNot: '',\n      name: meal.strMeal,\n      image: meal.strMealThumb\n    }];\n    const removeFavorite = storageFavorite.filter(item => item.id !== id);\n    return favorite ? localStorage.setItem('favoriteRecipes', JSON.stringify(removeFavorite)) : localStorage.setItem('favoriteRecipes', JSON.stringify(newFavorite));\n  }\n\n  function handleShare() {\n    copy(`http://localhost:3000/comidas/${id}`);\n    setShare(true);\n  }\n\n  function checkedStyle({\n    target: {\n      checked\n    }\n  }, ingredient) {\n    if (checked) return setIndexChecked(previous => [...previous, ingredient]);\n    const filterChecked = indexChecked.filter(item => item !== ingredient);\n    setIndexChecked(filterChecked);\n  }\n\n  function renderList() {\n    return listIngredients.map((item, index) => /*#__PURE__*/React.createElement(\"div\", {\n      key: index,\n      className: \"checkbox\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      htmlFor: \"checks\",\n      key: index,\n      className: indexChecked.includes(item[0]) ? 'text-decoration' : 'no-decoration',\n      \"data-testid\": `${index}-ingredient-step`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"checkbox\",\n      id: \"checks\",\n      onClick: ev => checkedStyle(ev, item[0]),\n      checked: indexChecked.includes(item[0]),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 11\n      }\n    }), `${item[0]} - ${item[1]}`)));\n  }\n\n  function handleFinishedRecipe() {\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date\n    const now = new Date();\n    const [month, day, year] = [now.getMonth(), now.getDate(), now.getFullYear()];\n    const finishedMeal = {\n      id: meal.idMeal,\n      type: 'comida',\n      area: meal.strArea,\n      category: meal.strCategory,\n      alcoholicOrNot: '',\n      name: meal.strMeal,\n      image: meal.strMealThumb,\n      doneDate: `${day}/${month}/${year}`\n    };\n    const finishedRecipes = JSON.parse(localStorage.getItem('doneRecipes')) || [];\n    localStorage.setItem('doneRecipes', JSON.stringify([...finishedRecipes, finishedMeal]));\n    history.push('/receitas-feitas');\n  }\n\n  if (loading) return /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 23\n    }\n  }, \"carregando\");\n  return /*#__PURE__*/React.createElement(\"section\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    className: \"img-bg\",\n    src: meal.strMealThumb,\n    \"data-testid\": \"recipe-photo\",\n    alt: \"imagem da refei\\xE7\\xE3o\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"header-progress\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    \"data-testid\": \"recipe-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 11\n    }\n  }, meal.strMeal), /*#__PURE__*/React.createElement(\"p\", {\n    \"data-testid\": \"recipe-category\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 11\n    }\n  }, meal.strMeal)), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    type: \"button\",\n    \"data-testid\": \"share-btn\",\n    className: \"icones-btn\",\n    onClick: handleShare,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    src: shareimg,\n    alt: \"icone compartilhar\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 13\n    }\n  }), share ? 'Link copiado!' : null), /*#__PURE__*/React.createElement(\"button\", {\n    type: \"button\",\n    \"data-testid\": \"favorite-btn\",\n    className: \"icones-btn\",\n    src: favorite ? heartBlack : heartWhite,\n    onClick: handleClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    src: favorite ? heartBlack : heartWhite,\n    alt: \"Favoritar\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 13\n    }\n  })))), renderList(), /*#__PURE__*/React.createElement(\"p\", {\n    \"data-testid\": \"instructions\",\n    className: \"p-progress\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 7\n    }\n  }, meal.strInstructions), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"btn-finalizar\",\n    type: \"button\",\n    \"data-testid\": \"finish-recipe-btn\",\n    disabled: finished,\n    onClick: handleFinishedRecipe,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 7\n    }\n  }, \"finalizar\"));\n}\n\nexport default ComidasEmProcesso;","map":{"version":3,"sources":["/Users/beatrizbarbosa/Projects/trybe-projects/sd-010-a-project-recipes-app/src/pages/ComidasEmProcesso.js"],"names":["React","useEffect","useState","useParams","useHistory","copy","fetchAPI","createIngredientsList","MEALS_BY_ID_ENDPOINT","ComidasEmProcesso","id","history","meal","setMeal","loading","setLoading","finished","setFinished","share","setShare","listIngredients","setListIngredients","storage","JSON","parse","localStorage","getItem","indexChecked","setIndexChecked","meals","storageFavorite","favorite","setFavorite","some","item","fetchMeal","data","ingredientes","filter","undefined","previousIngredientes","newIngredientes","setItem","stringify","length","handleClick","newFavorite","type","area","strArea","category","strCategory","alcoholicOrNot","name","strMeal","image","strMealThumb","removeFavorite","handleShare","checkedStyle","target","checked","ingredient","previous","filterChecked","renderList","map","index","includes","ev","handleFinishedRecipe","now","Date","month","day","year","getMonth","getDate","getFullYear","finishedMeal","idMeal","doneDate","finishedRecipes","push","shareimg","heartBlack","heartWhite","strInstructions"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useParams, useHistory } from 'react-router-dom';\nimport copy from 'clipboard-copy';\nimport fetchAPI from '../services/index';\nimport heartWhite from '../images/whiteHeartIcon.svg';\nimport heartBlack from '../images/blackHeartIcon.svg';\nimport shareimg from '../images/shareIcon.svg';\nimport { createIngredientsList } from '../utils';\nimport { MEALS_BY_ID_ENDPOINT } from '../services/meals';\nimport '../css/ComidasEmProcessoCSS.css';\n\nfunction ComidasEmProcesso() {\n  const { id } = useParams();\n  const history = useHistory();\n\n  const [meal, setMeal] = useState({});\n  const [loading, setLoading] = useState(false);\n  const [finished, setFinished] = useState(true);\n  const [share, setShare] = useState(false);\n  const [listIngredients, setListIngredients] = useState([]);\n\n  const storage = JSON.parse(localStorage.getItem('inProgressRecipes'));\n  const [indexChecked, setIndexChecked] = useState(storage.meals[id] || []);\n\n  const storageFavorite = JSON.parse(localStorage.getItem('favoriteRecipes')) || [];\n  const [favorite, setFavorite] = useState(storageFavorite\n    .some((item) => item.id === id));\n  // se retorna true está favoritado, se falso nao estava favoritado\n\n  useEffect(() => {\n    setLoading(true);\n    const fetchMeal = async () => {\n      const data = await fetchAPI(MEALS_BY_ID_ENDPOINT(id));\n      setMeal(data.meals[0]);\n      const ingredientes = createIngredientsList(data.meals[0]);\n      const filter = ingredientes.filter((item) => item[0] !== undefined);\n      setListIngredients(filter);\n\n      setLoading(false);\n    };\n\n    fetchMeal();\n  }, [id]);\n\n  useEffect(() => {\n    const previousIngredientes = JSON.parse(localStorage.getItem('inProgressRecipes'));\n    const newIngredientes = {\n      ...previousIngredientes,\n      meals: {\n        ...previousIngredientes.meals,\n        [id]: indexChecked,\n      },\n    };\n\n    localStorage.setItem('inProgressRecipes', JSON.stringify(newIngredientes));\n    setFinished(listIngredients.length !== indexChecked.length);\n  }, [indexChecked, listIngredients, id]);\n\n  function handleClick() {\n    // se retorna true está favoritado, se falso nao estava favoritado\n    setFavorite(!favorite);\n    const newFavorite = [\n      ...storageFavorite,\n      {\n        id,\n        type: 'comida',\n        area: meal.strArea,\n        category: meal.strCategory,\n        alcoholicOrNot: '',\n        name: meal.strMeal,\n        image: meal.strMealThumb,\n      },\n    ];\n    const removeFavorite = storageFavorite.filter((item) => item.id !== id);\n    return favorite ? localStorage.setItem(\n      'favoriteRecipes', JSON.stringify(removeFavorite),\n    )\n      : localStorage.setItem('favoriteRecipes', JSON.stringify(newFavorite));\n  }\n\n  function handleShare() {\n    copy(`http://localhost:3000/comidas/${id}`);\n    setShare(true);\n  }\n\n  function checkedStyle({ target: { checked } }, ingredient) {\n    if (checked) return setIndexChecked((previous) => ([...previous, ingredient]));\n    const filterChecked = indexChecked.filter((item) => item !== ingredient);\n    setIndexChecked(filterChecked);\n  }\n\n  function renderList() {\n    return listIngredients.map((item, index) => (\n      <div key={ index } className=\"checkbox\">\n        <label\n          htmlFor=\"checks\"\n          key={ index }\n          className={ indexChecked.includes(\n            item[0],\n          ) ? 'text-decoration' : 'no-decoration' }\n          data-testid={ `${index}-ingredient-step` }\n        >\n          <input\n            type=\"checkbox\"\n            id=\"checks\"\n            onClick={ (ev) => checkedStyle(ev, item[0]) }\n            checked={ indexChecked.includes(item[0]) }\n          />\n          { `${item[0]} - ${item[1]}` }\n        </label>\n      </div>\n    ));\n  }\n\n  function handleFinishedRecipe() {\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date\n    const now = new Date();\n    const [month, day, year] = [now.getMonth(), now.getDate(), now.getFullYear()];\n    const finishedMeal = {\n      id: meal.idMeal,\n      type: 'comida',\n      area: meal.strArea,\n      category: meal.strCategory,\n      alcoholicOrNot: '',\n      name: meal.strMeal,\n      image: meal.strMealThumb,\n      doneDate: `${day}/${month}/${year}`,\n    };\n    const finishedRecipes = JSON.parse(localStorage.getItem('doneRecipes')) || [];\n    localStorage.setItem('doneRecipes',\n      JSON.stringify([...finishedRecipes, finishedMeal]));\n\n    history.push('/receitas-feitas');\n  }\n\n  if (loading) return <p>carregando</p>;\n\n  return (\n    <section>\n      <img\n        className=\"img-bg\"\n        src={ meal.strMealThumb }\n        data-testid=\"recipe-photo\"\n        alt=\"imagem da refeição\"\n      />\n\n      <div className=\"header-progress\">\n        <div>\n          <h3 data-testid=\"recipe-title\">{ meal.strMeal }</h3>\n          <p data-testid=\"recipe-category\">{ meal.strMeal }</p>\n        </div>\n\n        <div>\n          <button\n            type=\"button\"\n            data-testid=\"share-btn\"\n            className=\"icones-btn\"\n            onClick={ handleShare }\n          >\n            <img src={ shareimg } alt=\"icone compartilhar\" />\n            { share ? 'Link copiado!' : null }\n          </button>\n\n          <button\n            type=\"button\"\n            data-testid=\"favorite-btn\"\n            className=\"icones-btn\"\n            src={ favorite ? heartBlack : heartWhite }\n            onClick={ handleClick }\n          >\n            <img src={ favorite ? heartBlack : heartWhite } alt=\"Favoritar\" />\n          </button>\n        </div>\n      </div>\n\n      { renderList() }\n\n      <p data-testid=\"instructions\" className=\"p-progress\">{ meal.strInstructions }</p>\n\n      <button\n        className=\"btn-finalizar\"\n        type=\"button\"\n        data-testid=\"finish-recipe-btn\"\n        disabled={ finished }\n        onClick={ handleFinishedRecipe }\n      >\n        finalizar\n      </button>\n    </section>\n  );\n}\n\nexport default ComidasEmProcesso;\n"]},"metadata":{},"sourceType":"module"}